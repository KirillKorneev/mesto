!function(e){var t={};function n(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(s,r,function(t){return e[t]}.bind(null,r));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=1)}([function(e,t,n){},function(e,t,n){"use strict";n.r(t);class s{constructor({cardName:e,cardLink:t,handleCardClick:n,handleLikeClick:s,handleDeleteIconClick:r},o){this._cardSelector=o,this._cardName=e,this._cardLink=t,this._cardLike=!1,this._handleCardClick=n,this._handleLikeClick=s,this._handleDeleteIconClick=r}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".element").cloneNode(!0)}isLiked(){return this._element.querySelector(".element__like").classList.contains("element__like_black")}plusLike(e){this._element.querySelector(".element__counter").textContent=e.likes.length+1}minusLike(e){this._element.querySelector(".element__counter").textContent=e.likes.length-1}removeTrash(){this._element.querySelector(".element__delete").remove()}setLikes(e){this._element.querySelector(".element__counter").textContent=e.likes.length}toggleLikeButton(){this._element.querySelector(".element__like").classList.toggle("element__like_black")}_toggleLike(){this._handleLikeClick()}_deleteCard(){this._handleDeleteIconClick()}removeCard(){this._element.remove()}_setEventListeners(){this._element.querySelector(".element__like").addEventListener("click",()=>this._toggleLike()),this._element.querySelector(".element__delete").addEventListener("click",()=>this._deleteCard()),this._element.querySelector(".element__photo").addEventListener("click",()=>this._handleCardClick())}getView(e,t){return e===t}generateCards(){this._element=this._getTemplate(),this._setEventListeners();const e=this._element.querySelector(".element__photo");return e.src=""+this._cardLink,e.alt=this._cardName,this._element.querySelector(".element__info").querySelector(".element__name").textContent=this._cardName,this._element}}class r{constructor(e,t){this._formElement=t,this._formSelector=e.formSelector,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass}_hasInvalidInput(e){return e.some(e=>!e.validity.valid)}_toggleButtonState(e,t){this._hasInvalidInput(e)?(t.disabled="true",t.classList.add(this._inactiveButtonClass)):(t.removeAttribute("disabled"),t.classList.remove(this._inactiveButtonClass))}_showInputError(e,t){const n=this._formElement.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),n.textContent=t,n.classList.add(this._errorClass)}_hideInputError(e){const t=this._formElement.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_setEventListeners(){const e=Array.from(this._formElement.querySelectorAll(this._inputSelector)),t=this._formElement.querySelector(this._submitButtonSelector);t.classList.contains("form__button_new")&&this._toggleButtonState(e,t),e.forEach(e=>{e.addEventListener("input",()=>this._checkInputValidity(e))}),e.forEach(n=>{n.addEventListener("input",()=>this._toggleButtonState(e,t))})}enableValidation(){this._formElement.addEventListener("submit",e=>{e.preventDefault()}),this._setEventListeners()}}class o{constructor({items:e,renderer:t},n){this._items=e,this._renderer=t,this._selector=document.querySelector(n)}addItem(e){this._selector.prepend(e)}_clear(){this._selector.innerHTML=""}renderItems(){this._clear(),this._items.forEach(e=>{this._renderer(e)})}}class i{constructor(e){this._popupElement=document.querySelector(e)}_handleEscClose(){return e=>{"Escape"===e.key&&this.close()}}close(){this._popupElement.classList.remove("popup_open"),document.removeEventListener("keydown",this._handleEscClose())}setEventListeners(){this._popupElement.querySelector(".popup__close").addEventListener("click",()=>{this.close()}),this._popupElement.addEventListener("click",(function(e){e.target.classList.contains("popup")&&this.classList.remove("popup_open")}))}open(){document.addEventListener("keydown",this._handleEscClose()),this._popupElement.classList.add("popup_open")}}class l extends i{constructor(e,t){super(e),this._sumbitPopup=t}_getInputValues(){const e=Array.from(this._popupElement.querySelectorAll(".form__input"));let t={};return e.forEach(e=>{t[e.name]=e.value}),t}close(){Array.from(this._popupElement.querySelectorAll(".form__input")).forEach(e=>{e.value=""}),super.close()}setEventListeners(){super.setEventListeners(),this._popupElement.addEventListener("submit",e=>{e.preventDefault(),this._sumbitPopup(this._getInputValues())})}}const a=document.querySelector(".popup"),c=document.querySelector(".popup_new"),u=(document.querySelector(".popup_photo"),document.querySelector(".profile__name")),h=document.querySelector(".profile__about"),_=document.querySelector(".form__button_new"),m=(document.querySelector(".elements"),{formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__input_error",errorClass:"form__input-error_active"}),d=Array.from(document.querySelectorAll(m.formSelector)),p=(document.forms.formChange,formChange.elements.inputChangeName),f=formChange.elements.inputChangeJob,v=document.querySelector(".profile__edit"),g=(a.querySelector(".popup__close"),document.querySelector(".profile__button")),L=document.forms.formAdd,y=(document.querySelector(".popup__close_new"),{name:L.elements.inputAddName,link:L.elements.inputAddLink}),b=(document.querySelector(".pop-image__close"),document.querySelector(".profile__avatar")),k=document.querySelector(".profile__changeImageButton"),E=document.querySelector(".form__button_update"),S=document.querySelector(".popup_updatePhoto"),C=document.querySelector(".popup_agreement");n.p,n(0);const q=new o({items:null,renderer:null},".elements"),I=new class{constructor({baseURL:e,headers:t}){this.baseURL=e,this.headers=t}_getResponseData(e){return e.ok?e.json():Promise.reject("Ошибка: "+e.status)}getItems(e){return fetch(`${this.baseURL}/${e}`,{headers:this.headers}).then(e=>this._getResponseData(e))}deleteItem(e,t){return fetch(`${this.baseURL}/${e}/${t}`,{method:"DELETE",headers:this.headers}).then(e=>this._getResponseData(e))}createItem(e,t,n){return fetch(`${this.baseURL}/${e}`,{method:"POST",headers:this.headers,body:JSON.stringify({name:t,link:n})}).then(e=>this._getResponseData(e))}putLike(e,t){return fetch(`${this.baseURL}/${e}/${t}`,{method:"PUT",headers:this.headers}).then(e=>this._getResponseData(e))}removeLike(e,t){return fetch(`${this.baseURL}/${e}/${t}`,{method:"DELETE",headers:this.headers}).then(e=>this._getResponseData(e))}getUserInformation(e){return fetch(`${this.baseURL}/${e}`,{headers:this.headers}).then(e=>this._getResponseData(e))}profileEding(e,t,n){return fetch(`${this.baseURL}/${e}`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:t,about:n})}).then(e=>this._getResponseData(e))}avatarEding(e,t){return fetch(`${this.baseURL}/${e}`,{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:t})}).then(e=>this._getResponseData(e))}}({baseURL:"https://mesto.nomoreparties.co/v1/cohort-14",headers:{"Content-Type":"application/json",authorization:"42b45684-18cf-461b-be7b-02246c8d8e0d"}}),w=new class extends i{constructor(e,t){super(e),this._sumbitPopup=t}setSubmitAction(e){this._sumbitPopup=e}setEventListeners(){super.setEventListeners(),this._popupElement.addEventListener("submit",e=>{e.preventDefault(),this._sumbitPopup()})}}(".popup_agreement",()=>{});w.setEventListeners(),d.forEach(e=>{new r(m,e).enableValidation()});const $=new class{constructor({userInfo:e,userName:t,userAvatar:n}){this._name=t,this._info=e,this._url=n}getUserInfo(){return{name:this._name.textContent,job:this._info.textContent}}setUserInfo({name:e,job:t,url:n}){this._name.textContent=e,this._info.textContent=t,this._url.style=`background-image: url(${n});`}}({userInfo:h,userName:u,userAvatar:b});function U(e,t,n,s){e.querySelector(".form__button").textContent=t?n:s}function x(e,t,n){const r=new s({cardName:t.name,cardLink:t.link,handleCardClick:()=>{A.open(t.name,t.link)},handleLikeClick:()=>{r.isLiked()?I.removeLike("cards/likes",e).then(e=>{r.toggleLikeButton(),r.minusLike(t)}).catch(e=>{console.log("Ошибка "+e)}):I.putLike("cards/likes",e).then(e=>{r.toggleLikeButton(),r.plusLike(t)}).catch(e=>{console.log("Ошибка "+e)})},handleDeleteIconClick:()=>{w.setSubmitAction(t=>{U(C,!0,"Удаление...","Удалить"),I.deleteItem("cards",e).then(e=>{r.removeCard(),w.close()}).catch(e=>{console.log("Ошибка "+e)}).finally(()=>{U(C,!1,"Удаление...","Удалить")})}),w.open()}},"#tem-element"),o=r.generateCards();r.getView(n,t.owner._id)||r.removeTrash();for(let e=0;e<t.likes.length;e++)t.likes[e]._id===n&&r.toggleLikeButton();r.setLikes(t),q.addItem(o)}Promise.all([I.getUserInformation("users/me"),I.getItems("cards")]).then(e=>{const[t,n]=e;$.setUserInfo({name:t.name,job:t.about,url:t.avatar});const s=t._id;new o({items:n,renderer:e=>{x(e._id,e,s)}},".elements").renderItems()}).catch(e=>{console.log("Ошибка "+e)});const R=new l(".popup_info",e=>{U(a,!0,"Сохранение...","Сохранить"),I.profileEding("users/me",e.inputChangeName,e.inputChangeJob).then(e=>{$.setUserInfo({name:e.name,job:e.about,url:e.avatar}),R.close()}).catch(e=>{console.log(e)}).finally(()=>{U(a,!1,"Сохранение...","Сохранить")})});R.setEventListeners(),v.addEventListener("click",()=>{const e=$.getUserInfo();p.value=e.name,f.value=e.job,R.open()});const A=new class extends i{constructor(e){super(e)}open(e,t){const n=this._popupElement.querySelector(".pop-image__image");n.src=t,this._popupElement.querySelector(".pop-image__about").textContent=e,n.alt=e,super.open()}}(".popup_photo");A.setEventListeners(),g.addEventListener("click",()=>{_.disabled="true",_.classList.add("form__button_inactive"),P.open()});const P=new l(".popup_new",()=>{U(c,!0,"Создание...","Создать");const e={name:y.name.value,link:y.link.value};Promise.all([I.getUserInformation("users/me"),I.createItem("cards",e.name,e.link)]).then(e=>{const[t,n]=e,s=t._id;x(n._id,n,s),P.close()}).catch(e=>{console.log("Ошибка "+e)}).finally(()=>{U(c,!1,"Создание...","Создать")})});P.setEventListeners();const D=new l(".popup_updatePhoto",e=>{U(S,!0,"Сохранение...","Сохранить"),I.avatarEding("users/me/avatar",e.inputAddName).then(e=>{$.setUserInfo({name:e.name,job:e.about,url:e.avatar}),D.close()}).catch(e=>{console.log(e)}).finally(()=>{U(S,!1,"Сохранение...","Сохранить")})});D.setEventListeners(),k.addEventListener("click",()=>{E.disabled="true",E.classList.add("form__button_inactive"),D.open()})}]);